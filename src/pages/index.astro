---
import Layout from "@layouts/Layout.astro";
import Container from "@components/Container.astro";
import { SITE, HOME } from "@consts";
import ArrowCard from "@components/ArrowCard.astro";
import Link from "@components/Link.astro";
import { getCollection } from "astro:content";

// â–¼â–¼â–¼ å…¨ã¦ã®ãƒ–ãƒ­ã‚°è¨˜äº‹ã‚’å–å¾—ï¼ˆã‚¹ãƒ©ã‚¤ã‚¹ã—ãªã„ï¼‰â–¼â–¼â–¼
const allBlogPosts = (await getCollection("blog"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// æœ€æ–°ã®æŠ•ç¨¿ç”¨ã«è¨˜äº‹ã‚’ã‚¹ãƒ©ã‚¤ã‚¹
const recentPosts = allBlogPosts.slice(0, SITE.NUM_POSTS_ON_HOMEPAGE);

// â–¼â–¼â–¼ ã€Œpythonã€ã‚¿ã‚°ã‚’æŒã¤è¨˜äº‹ã ã‘ã‚’æŠ½å‡º â–¼â–¼â–¼
const pythonPosts = allBlogPosts.filter(post =>
  post.data.tags?.includes("Python")
);

// â–¼â–¼â–¼ ã€Œãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã®æ•°å­¦ã€ã‚¿ã‚°ã‚’æŒã¤è¨˜äº‹ã ã‘ã‚’æŠ½å‡º â–¼â–¼â–¼
const mathPosts = allBlogPosts.filter(post =>
  post.data.tags?.includes("ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã®æ•°å­¦")
);

// ã‚¿ã‚°é–¢é€£ã®ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå¤‰æ›´ãªã—ï¼‰
const allTags = new Set<string>();
allBlogPosts.forEach(post => {
  if (Array.isArray(post.data.tags)) {
    post.data.tags.forEach(tag => allTags.add(tag));
  }
});
const sortedTags = Array.from(allTags).sort((a, b) =>
  a.localeCompare(b, 'ja', { sensitivity: 'base' })
);
---

<Layout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <aside class="space-y-16" data-pagefind-ignore>

      {/* è‡ªå·±ç´¹ä»‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
      <section class="animate">
        <article class="space-y-4">
          <h1 class="font-semibold text-black dark:text-white">
            ã»ã®ã«ã£ãã ã‚ˆ
          </h1>
          <p>ã€Œã»ã®ã«ã£ãã€ã«ã‚¢ã‚¯ã‚»ã‚¹ã„ãŸã ãã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚</p>
          <p>
            ã“ã®ã‚µã‚¤ãƒˆã§ã¯ã€æ—¥ã€…ã®ç ”ç©¶æ´»å‹•ã§å­¦ã‚“ã ã“ã¨ãªã©ã‚’è¼‰ã›ã¦ã„ãäºˆå®šã ã‚ˆã€‚
            æœ€æ–°ã®è¨˜äº‹ã¯<Link href="/blog">ãƒ–ãƒ­ã‚°ãƒšãƒ¼ã‚¸</Link>ã‹ã‚‰è¦‹ã¦ã­ã€‚
          </p>
        </article>
      </section>

      {/* Python è¨˜äº‹ä¸€è¦§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
      <section class="animate space-y-6">
        <div class="flex flex-wrap items-center justify-between gap-y-2">
          <h2 class="font-semibold text-black dark:text-white">
            Python ã‚’å­¦ã¶ ğŸ
          </h2>
          <Link href="/python/">Pythonã®è¨˜äº‹ä¸€è¦§ã‚’è¦‹ã‚‹</Link>
        </div>
        <ul class="not-prose flex flex-col gap-4">
          {pythonPosts.map((post) => (
            <li><ArrowCard entry={post} /></li>
          ))}
        </ul>
      </section>

      {/* ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã®æ•°å­¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
      <section class="animate space-y-6">
        <div class="flex flex-wrap items-center justify-between gap-y-2">
          <h2 class="font-semibold text-black dark:text-white">
            ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã®æ•°å­¦ã‚’å­¦ã¶ ğŸ“š
          </h2>
          <Link href="/tags/ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚¨ãƒ³ã‚¹ã®æ•°å­¦">
            ã“ã®ã‚·ãƒªãƒ¼ã‚ºã®ã™ã¹ã¦ã®è¨˜äº‹ã‚’è¦‹ã‚‹
          </Link>
        </div>
        <ul class="not-prose flex flex-col gap-4">
          {mathPosts.map((post) => (
            <li><ArrowCard entry={post} /></li>
          ))}
        </ul>
      </section>

      {/* æœ€æ–°ã®æŠ•ç¨¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
      <section class="animate space-y-6">
        <div class="flex flex-wrap items-center justify-between gap-y-2">
          <h2 class="font-semibold text-black dark:text-white">
            æœ€æ–°ã®æŠ•ç¨¿
          </h2>
          <Link href="/blog">ã™ã¹ã¦ã®æŠ•ç¨¿ã‚’è¦‹ã‚‹</Link>
        </div>
        <ul class="not-prose flex flex-col gap-4">
          {recentPosts.map((post) => (
            <li><ArrowCard entry={post} /></li>
          ))}
        </ul>
      </section>

      {/* ã‚¿ã‚°ä¸€è¦§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */}
      <section class="animate space-y-6">
        <div class="flex flex-wrap items-center justify-between gap-y-2">
          <h2 class="font-semibold text-black dark:text-white">
            è¨˜äº‹ã®åˆ†é¡ï¼ˆã‚¿ã‚°ï¼‰
          </h2>
        </div>
        <div class="not-prose flex flex-wrap gap-2">
          {sortedTags.length > 0 ? (
            sortedTags.map(tag => (
              <Link href={`/tags/${tag}`} class="tag-badge">
                {tag}
              </Link>
            ))
          ) : (
            <p>ã¾ã ã‚¿ã‚°ãŒãªã„ã¿ãŸã„...</p>
          )}
        </div>
      </section>

    </aside>
  </Container>
</Layout>

<style>
  /* styleã‚¿ã‚°ã®ä¸­èº«ã¯å¤‰æ›´ã‚ã‚Šã¾ã›ã‚“ */
  .tag-badge {
    display: inline-block;
    padding: 0.5rem 1rem;
    background-color: theme('colors.sky.100');
    color: theme('colors.sky.800');
    border-radius: 9999px;
    font-size: 0.9rem;
    font-weight: 600;
    text-decoration: none;
    transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
    white-space: nowrap;
  }
  :root.dark .tag-badge {
    background-color: theme('colors.neutral.700');
    color: theme('colors.neutral.200');
  }
  .tag-badge:hover {
    background-color: theme('colors.sky.200');
    color: theme('colors.sky.900');
    text-decoration: none;
  }
  :root.dark .tag-badge:hover {
    background-color: theme('colors.neutral.600');
    color: theme('colors.neutral.100');
  }
  .tag-badge a {
    text-decoration: none !important;
  }
</style>
